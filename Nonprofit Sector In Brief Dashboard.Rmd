---
title: "Nonprofit Sector In Brief Dashboard"
date: "`r lubridate::today()`"
output: 
  flexdashboard::flex_dashboard:
    social: menu
    source_code: embed
    theme: cosmo
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, 
                      message = FALSE, 
                      warning =FALSE)
```

```{r, include=FALSE}
library(flexdashboard)
library(htmlwidgets)
library(DT)

library(httr)
library(tidyverse)
library(stringr)
library(RCurl)
library(reshape2)
library(RColorBrewer)
library(extrafont)
library(knitr)
library(foreign)
library(kableExtra)
library(urbnthemes)
library(grid)
library(gridExtra)
library(rmarkdown)
library(plotly)

set_urbn_defaults()
```



Summary {.storyboard}
=======================================================================

### A sketch of the nonprofit landscape in the US

```{r}
Data_1 <- read_csv("Number_nonprofit_trend.csv") %>%
  select(!1)
Data_1$Year = as.character(Data_1$Year)

datatable(Data_1, style = "auto",  options = list(pageLength = 5))
```



***

- The number of nonprofits have been steadily decreasing since 2019. 
- Public charities, a special type of nonprofits, followed the same trend. 
- The phenomenon highlights the impacts of COVID pandemics on the nonprofit landscape.



### Visual Representation
```{r}
Data_1 %>%
  ggplot(aes(x = as.factor(Year), group=1)) +
  geom_line(aes(y = `All registered nonprofits`, color = "blue")) +
  geom_point(aes(y = `All registered nonprofits`, color = "blue")) +
  geom_line(aes(y = `501(c)(3) public charities`, color = "red")) +
  geom_point(aes(y = `501(c)(3) public charities`, color = "red")) +
  ggtitle("Total Nonprofit Counts by Year", subtitle = "From 2019 to 2022") +
  labs(x = "Year", y = " ") +
   guides(color = guide_legend(title = " ")) +
  scale_color_discrete(labels = c("All registered nonprofits", "501(c)(3) public charities")) +
   geom_text(aes(as.factor(Year),`All registered nonprofits` , label= `All registered nonprofits`),
              vjust= -1, 
              position = position_dodge(width=1),
              size =3) +
   geom_text(aes(as.factor(Year),`501(c)(3) public charities` , label= `501(c)(3) public charities`),
              vjust=-1, 
              position = position_dodge(width=1),
              size =3) +
   ylim(NA, 1550000)
```

***

It shall be pointed out from the graph that the 2020 data is missing.


Finance {.storyboard}
=======================================================================

### Financial Information By Nonprofit Type
```{r}
data_2 <- read_csv("Nonprofit_finance_2019.csv") %>%
  select(!1)

data_2 <-
  data_2 %>%
  filter(!Variable %in% c("Reporting nonprofits", "Reporting public charities"), Type %in% c("PC", "CO", "PF")) %>%
  pivot_wider(names_from = Type, values_from = Value)

datatable(data_2, style = "auto",  options = list(pageLength = 5))
```

***
Peaking into the financial landscape of all US-based nonprofits in 2019

- Public Charities had significantly more reporting, revenue, expenses, and assets than the other two categories
- Private Foundation is the minority



### What happened here?
```{r}
data_3 <- read_csv("Nonprofit_finance_2019.csv") %>%
  select(!1)
p <- data_3 %>%
  filter(Type  %in% c("PC", "CO", "PF"), Variable != "Reporting") %>%
  ggplot(aes(x = Variable, y = Value, fill = Type)) +
  geom_col(position = "dodge") +
  geom_text(aes(Variable, Value, label=Value),
              vjust=-1, 
              position = position_dodge(width=1),
              size =3) +
  ylim(NA, 5000) +
   theme(legend.position="right", legend.direction = "vertical")

ggplotly(p)

```

***

- Huge Assets for Public Charities!


### Another way of looking at it!

```{r}
datatable(data_3, style = "auto",  options = list(pageLength = 10))
```



Exploration
=======================================================================

### Inline Shiny App via shinyApp

Some words

```{r, include=F}
# shinyApp(
#   ui = fillPage(
#     fillCol(flex = c(NA, 1), 
#       inputPanel(
#         selectInput("region", "Region:", choices = colnames(WorldPhones))
#       ),
#       plotOutput("phonePlot", height = "100%")
#     )
#   ),
#   server = function(input, output) {
#     output$phonePlot <- renderPlot({
#       barplot(WorldPhones[,input$region]*1000, 
#               ylab = "Number of Telephones", xlab = "Year")
#     })
#   },
#   options = list(height = 600)
# )
```




Trend
=======================================================================



Row {data-height=400}
-----------------------------------------------------------------------
### External Shiny App via shinyAppDir


Row {data-height=400}
-----------------------------------------------------------------------
### External Shiny App via shinyAppDir
```{r}

```


Geography
=======================================================================

### External Shiny App via shinyAppDir

Column {data-height=400}
-----------------------------------------------------------------------
### External Shiny App via shinyAppDir

Column {data-height=400}
-----------------------------------------------------------------------
### External Shiny App via shinyAppDir

Some words

```{r}
# shinyAppDir(
#   system.file("examples/06_tabsets", package="shiny"),
#   options = list(height=850)
# )
```

